---
import type { BlogEntry } from '../lib/blog';

type Pagination = {
  currentPage: number;
  lastPage: number;
};

type Props = {
  posts: BlogEntry[];
  pagination?: Pagination;
};

const { posts, pagination } = Astro.props as Props;
const tagColors = [
  "from-emerald-500/30 to-emerald-700/40 text-emerald-100 border-emerald-600/60",
  "from-cyan-500/25 to-blue-700/40 text-cyan-100 border-blue-600/60",
  "from-amber-400/25 to-orange-600/40 text-amber-100 border-orange-500/60",
  "from-pink-500/25 to-rose-700/40 text-pink-100 border-rose-600/60",
  "from-sky-500/25 to-indigo-700/40 text-sky-100 border-indigo-600/60"
];
const tagStyle = (tag: string) => tagColors[Math.abs(tag.toLowerCase().split('').reduce((a, c) => a + c.charCodeAt(0), 0)) % tagColors.length];
const difficultyTone = (score: number) => {
  if (score <= 1) return "bg-emerald-400 shadow-glow";
  if (score === 2) return "bg-teal-400 shadow-glow";
  if (score === 3) return "bg-amber-400 shadow-glow";
  if (score === 4) return "bg-orange-400 shadow-glow";
  return "bg-rose-400 shadow-glow";
};
---

<div class="space-y-6">
  {posts.length === 0 ? (
    <div class="rounded-3xl border border-[var(--border)] bg-[var(--card)]/80 p-6 text-[var(--muted)]">
      No posts yet â€” first entry coming soon.
    </div>
  ) : (
    <div class="grid gap-4 md:grid-cols-2">
      {posts.map((post) => (
        <a
          href={`/blog/${post.slug}`}
          class="group flex h-full flex-col justify-between rounded-3xl border border-[var(--border)] bg-[var(--card)]/80 p-6 shadow-card transition hover:-translate-y-1.5 hover:border-[var(--accent)] hover:shadow-glow"
        >
          <div class="space-y-4">
            <div class="flex items-center justify-between text-xs uppercase tracking-[0.16em] text-[var(--muted)]">
              <span>{new Date(post.data.pubDate).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })}</span>
              <div class="flex items-center gap-2">
                <span class="rounded-full border border-[var(--border)] bg-[var(--card)]/80 px-2 py-1 text-[11px] font-semibold text-[var(--text)]">
                  {post.data.readTime} min read
                </span>
                <span class="inline-flex items-center gap-1 rounded-full border border-[var(--border)] bg-[var(--card)]/80 px-2 py-1 text-[11px] font-semibold text-[var(--text)]">
                  <span class={`h-1.5 w-1.5 rounded-full ${difficultyTone(post.data.difficulty ?? 3)}`} />
                  {post.data.difficulty ?? 3}/5
                </span>
              </div>
            </div>
            <h3 class="text-xl font-semibold group-hover:text-[var(--accent)]">{post.data.title}</h3>
            <p class="text-[var(--muted)]">{post.data.description}</p>
          </div>
          <div class="mt-5 flex flex-wrap gap-2 text-xs text-[var(--muted)]">
            {post.data.tags.slice(0, 4).map((tag) => (
              <span class={`rounded-full border px-3 py-1 bg-gradient-to-r ${tagStyle(tag)}`}>#{tag}</span>
            ))}
          </div>
        </a>
      ))}
    </div>
  )}

  {pagination && pagination.lastPage > 1 && (
    <div class="flex flex-wrap items-center justify-center gap-3 rounded-2xl border border-[var(--border)] bg-[var(--card)]/60 px-4 py-3 text-sm text-[var(--muted)]">
      {Array.from({ length: pagination.lastPage }).map((_, index) => {
        const pageNumber = index + 1;
        const href = pageNumber === 1 ? "/blog" : `/blog/page/${pageNumber}`;
        const isActive = pageNumber === pagination.currentPage;
        return (
          <a
            href={href}
            class:list={[
              "rounded-full px-4 py-2 transition",
              isActive ? "bg-[var(--accent)] text-[var(--bg)] shadow-glow" : "border border-[var(--border)] hover:border-[var(--accent)] hover:text-[var(--accent)]"
            ]}
            aria-current={isActive ? "page" : undefined}
          >
            {pageNumber}
          </a>
        );
      })}
    </div>
  )}
</div>
